{% extends "base.html" %}

{% block title %}å›¾åºŠè½¬å‘ - é¦–é¡µ{% endblock %}

{% block extra_css %}
{{ super() }}
{# Removed custom body background styles. Base.html now handles global background. #}
{# Index page will inherit background_image_filename and background_opacity from the view context, #}
{# and base.html will use them. #}
{% endblock %}
{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col">
        </div>
    </div>

    {% if collections %}
    <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3"> {# å‡å°‘åˆ—æ•°è®©å¡ç‰‡æ›´å¤§ï¼Œå‡å°é—´è· #}
        {% for collection in collections %}
        <div class="col">
            <a href="{{ url_for('main.view_collection', collection_name=collection.name) }}"
                class="text-decoration-none">
                <div class="card h-100 folder-card">
                    <div class="card-body">
                        {# å¤§å°é¢å›¾ç‰‡åŒºåŸŸ #}
                        <div class="folder-icon-wrapper">
                            {% if collection.has_content %}
                            <img src="{{ url_for('redirect.random_redirect', collection_name=collection.name) }}?t={{ range(1, 999999) | random }}"
                                alt="{{ collection.name }} cover" class="folder-cover-img cover-refresh"
                                data-api-url="{{ url_for('redirect.random_redirect', collection_name=collection.name) }}"
                                title="ğŸ‘†ç‚¹å‡»å›¾ç‰‡å¯åˆ·æ–°é¢„è§ˆ">
                            {% else %}
                            {# ç©ºåˆé›†æ˜¾ç¤ºé»˜è®¤æ–‡ä»¶å¤¹å›¾æ ‡ #}
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor"
                                class="bi bi-folder-fill" viewBox="0 0 16 16">
                                <path
                                    d="M9.828 3h3.982a2 2 0 0 1 1.992 2.181l-.637 7A2 2 0 0 1 13.174 14H2.826a2 2 0 0 1-1.991-1.819l-.637-7a1.99 1.99 0 0 1 .342-1.31L.5 3a2 2 0 0 1 2-2h3.672a2 2 0 0 1 1.414.586l.828.828A2 2 0 0 0 9.828 3zm-8.322.12C1.72 3.042 1.95 3 2.19 3h5.396l-.707-.707A1 1 0 0 0 6.172 2H2.5a1 1 0 0 0-1 .981l.006.139z" />
                            </svg>
                            {% endif %}
                            {# å³ä¸‹è§’æ‚¬æµ®æ ‡ç­¾æ˜¾ç¤ºåˆé›†åç§° #}
                            <span class="card-label">{{ collection.name }}</span>
                        </div>
                    </div>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info">
        <p>è¿˜æ²¡æœ‰åˆ›å»ºä»»ä½•å›¾ç‰‡åˆé›†ã€‚è¯·å‰å¾€<a href="{{ url_for('admin.login_page') }}">ç®¡ç†é¡µé¢</a>åˆ›å»ºä¸€ä¸ªåˆé›†ã€‚</p>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
{{ super() }}
<script>
    // ç‚¹å‡»å°é¢å›¾ç‰‡åˆ·æ–°æ˜¾ç¤ºæ–°çš„éšæœºå›¾ç‰‡
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.cover-refresh').forEach(function (img) {
            img.addEventListener('click', function (e) {
                e.preventDefault();
                e.stopPropagation();
                // é€šè¿‡æ·»åŠ æ—¶é—´æˆ³å‚æ•°å¼ºåˆ¶åˆ·æ–°å›¾ç‰‡
                const apiUrl = this.getAttribute('data-api-url');
                this.src = apiUrl + '?t=' + Date.now();
            });
        });
    });
</script>
{% endblock %}